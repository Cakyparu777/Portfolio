version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Starting preBuild phase..."
        - echo "Installing Node.js 20..."
        - nvm install 20
        - nvm use 20
        - echo "Node version:"
        - node --version
        - echo "NPM version:"
        - npm --version
        - echo "Installing dependencies..."
        - npm ci --prefer-offline --no-audit --progress=false
        - echo "Dependencies installed successfully"
    build:
      commands:
        - echo "Starting build phase..."
        - echo "Building Next.js app..."
        - npm run build
        - echo "Build completed successfully"
        - echo "Creating required files for Amplify compatibility..."
        - echo '{}' > out/required-server-files.json
        - mkdir -p out/.next
        - echo '{}' > out/.next/trace
  artifacts:
    baseDirectory: out
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
